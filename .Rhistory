"CH_DIAT_C_RHF",
"CH_DIAT_C_ZNC",
"CH_ARIS_C_ARI",
"CH_ARIS_C_ADV",
"CH_ARIS_C_ABI",
"CH_FEVR_C_FEV",
"CH_FEVT_C_ABI",
"CH_FEVT_C_ADV",
"CH_FEVT_C_AML",
"CN_BRFS_C_EXB",
"CN_BRFS_C_CMP",
"CH_VACS_C_BCG",
"CH_VACS_C_BAS",
"CH_VACS_C_MSL",
"HA_KMTC_W_BFD",
"HA_CATH_W_ATR",
"RH_ANCP_W_CHW",
"RH_ANCN_W_N4P",
"RH_ANCC_W_IRN",
"RH_TTIJ_W_PRT",
"RH_DELA_C_SKP",
"RH_PCCT_C_DY2",
"RH_PCCP_C_DOC",
"ML_NETP_H_ITN",
"ML_IRSM_H_IRS",
"ML_IRSM_H_IIR"
)
prep.ebi <- function(indicator.list, cause.map = NULL) {
# Import DHS Indicator data for TFR for each survey
json_file <- fromJSON("https://api.dhsprogram.com/rest/dhs/data/FE_FRTR_W_TFR?perpage=500")
pull.indicator <- function(indicator) {
string <- paste0("https://api.dhsprogram.com/rest/dhs/data/", indicator, "?perpage=500")
json_file <- fromJSON(string)
json_data <- lapply(json_file$Data, function(x) { unlist(x) })
APIdata <- as.data.table(do.call("rbind", json_data),stringsAsFactors=FALSE)
return(APIdata)
}
dt <- rbindlist(lapply(indicator.list, pull.indicator))
dt[, Year := as.integer(SurveyYear)]
dt[, Value := as.numeric(Value)]
return(dt[])
}
ebi.dt <- prep.ebi(indicator.list)
ebi.dt
names(ebi.dt)
unique(ebi.dt[, .(DataId, Indicator)])
View(unique(ebi.dt[, .(IndicatorId, Indicator)]))
View(unique(ebi.dt[, .(IndicatorId, Indicator)]))
names(ebi.dt)
unique(ebi.dtByVariableLable)
unique(ebi.dt$ByVariableLable)
unique(ebi.dt$ByVariableLabel)
ebi.dt[IndicatorId == "CN_BRFS_C_CMP"]
unique(ebi.dt$CharacteristicLabel)
ebi.dt[IndicatorId == "CN_BRFS_C_EXP"]
ebi.dt[IndicatorId == "CN_BRFS_C_EXB"]
ebi.path <- paste0("data/indicator_list.csv")
## EBI
indicator.list <- fread(ebi.path)
indicator.table <- fread(ebi.path)
indicator.list <- unique(indicator.table$code)
prep.ebi <- function(indicator.list, cause.map = NULL) {
# Import DHS Indicator data for TFR for each survey
json_file <- fromJSON("https://api.dhsprogram.com/rest/dhs/data/FE_FRTR_W_TFR?perpage=500")
pull.indicator <- function(indicator) {
string <- paste0("https://api.dhsprogram.com/rest/dhs/data/", indicator, "?perpage=500")
json_file <- fromJSON(string)
json_data <- lapply(json_file$Data, function(x) { unlist(x) })
APIdata <- as.data.table(do.call("rbind", json_data),stringsAsFactors=FALSE)
return(APIdata)
}
dt <- rbindlist(lapply(indicator.list, pull.indicator))
dt[, Year := as.integer(SurveyYear)]
dt[, Value := as.numeric(Value)]
return(dt[])
}
ebi.dt <- prep.ebi(indicator.list)
indicator.list
ebi.path <- paste0("data/indicator_list.csv")
(ebi.path)
## EBI
indicator.table <- fread(ebi.path)
indicator.table
indicator.table
ebi.path
## EBI
indicator.table <- fread(ebi.path)
indicator.table
## EBI
indicator.table <- read_csv(ebi.path)
## EBI
indicator.table <- read.csv(ebi.path)
indicator.table
## EBI
indicator.table <- data.table(read.csv(ebi.path))
indicator.table
indicator.list <- unique(indicator.table$code)
indicator.list
indicator.table
indicator.table <- data.table(read.csv(ebi.path))
indicator.list <- unique(indicator.table$code)
prep.ebi <- function(indicator.list, cause.map = NULL) {
# Import DHS Indicator data for TFR for each survey
json_file <- fromJSON("https://api.dhsprogram.com/rest/dhs/data/FE_FRTR_W_TFR?perpage=500")
pull.indicator <- function(indicator) {
string <- paste0("https://api.dhsprogram.com/rest/dhs/data/", indicator, "?perpage=500")
json_file <- fromJSON(string)
json_data <- lapply(json_file$Data, function(x) { unlist(x) })
APIdata <- as.data.table(do.call("rbind", json_data),stringsAsFactors=FALSE)
return(APIdata)
}
dt <- rbindlist(lapply(indicator.list, pull.indicator))
dt[, Year := as.integer(SurveyYear)]
dt[, Value := as.numeric(Value)]
return(dt[])
}
ebi.dt <- prep.ebi(indicator.list)
ebi.dt
ebi.raw <- prep.ebi(indicator.list)
names(ebi.dt)
indicator.table <- data.table(read.csv(ebi.path))
indicator.list <- unique(indicator.table$IndicatorId)
prep.ebi <- function(indicator.list, cause.map = NULL) {
# Import DHS Indicator data for TFR for each survey
json_file <- fromJSON("https://api.dhsprogram.com/rest/dhs/data/FE_FRTR_W_TFR?perpage=500")
pull.indicator <- function(indicator) {
string <- paste0("https://api.dhsprogram.com/rest/dhs/data/", indicator, "?perpage=500")
json_file <- fromJSON(string)
json_data <- lapply(json_file$Data, function(x) { unlist(x) })
APIdata <- as.data.table(do.call("rbind", json_data),stringsAsFactors=FALSE)
return(APIdata)
}
dt <- rbindlist(lapply(indicator.list, pull.indicator))
dt[, Year := as.integer(SurveyYear)]
dt[, Value := as.numeric(Value)]
return(dt[])
}
ebi.raw <- prep.ebi(indicator.list)
ebi.subset <- ebi.raw[, .(IndicatorId, Year, Value, CountryName)]
merge(ebi.subset, ebi.table)
merge(ebi.subset, indicator.table)
setnames(ebi.dt, c("CountryName", "Year"), c("location", "year"))
ebi.dt
ebi.raw <- prep.ebi(indicator.list)
ebi.subset <- ebi.raw[, .(IndicatorId, Year, Value, CountryName)]
ebi.dt <- merge(ebi.subset, indicator.table)
setnames(ebi.dt, c("CountryName", "Year"), c("location", "year"))
ebi.dt
indicator.table <- data.table(read.csv(ebi.path))
indicator.list <- unique(indicator.table$IndicatorId)
prep.ebi <- function(indicator.list, cause.map = NULL) {
# Import DHS Indicator data for TFR for each survey
json_file <- fromJSON("https://api.dhsprogram.com/rest/dhs/data/FE_FRTR_W_TFR?perpage=500")
pull.indicator <- function(indicator) {
string <- paste0("https://api.dhsprogram.com/rest/dhs/data/", indicator, "?perpage=500")
json_file <- fromJSON(string)
json_data <- lapply(json_file$Data, function(x) { unlist(x) })
APIdata <- as.data.table(do.call("rbind", json_data),stringsAsFactors=FALSE)
return(APIdata)
}
dt <- rbindlist(lapply(indicator.list, pull.indicator))
dt[, Year := as.integer(SurveyYear)]
dt[, Value := as.numeric(Value)]
return(dt[])
}
ebi.raw <- prep.ebi(indicator.list)
ebi.subset <- ebi.raw[, .(IndicatorId, Year, Value, CountryName)]
ebi.dt <- merge(ebi.subset, indicator.table)
setnames(ebi.dt, c("CountryName", "Year", "Value"), c("location", "year", "value"))
# DPT3 coverage from WHO
dpt.dt <- fread(dpt.path, header = T)
melt.dpt <- melt(dpt.dt, id.vars = "Cname", variable.name = "year")
setnames(melt.dpt, "Cname", "location")
melt.dpt[, c("Category", "Indicator") := .("DPT", "DPT3 Vaccine")]
ebi.dt <- rbind(ebi.dt, melt.dpt)
write.csv(ebi.dt, ebi.out, row.names = F)
names(melt.dpt)
ebi.dt[, IndicatorId := NULL]
# DPT3 coverage from WHO
dpt.dt <- fread(dpt.path, header = T)
melt.dpt <- melt(dpt.dt, id.vars = "Cname", variable.name = "year")
setnames(melt.dpt, "Cname", "location")
melt.dpt[, c("Category", "Indicator") := .("DPT", "DPT3 Vaccine")]
ebi.dt <- rbind(ebi.dt, melt.dpt)
write.csv(ebi.dt, ebi.out, row.names = F)
write.csv(ebi.dt, ebi.out, row.names = F)
write.csv(ebi.dt, ebi.out, row.names = F)
### Data Prep
library(data.table); library(RJSONIO); library(ggplot2); library(plotly)
## Paths
# In
data.dir <- "data/raw/"
data.path <- paste0(data.dir, "GBD16_results_all2.csv")
ebi.path <- paste0("data/indicator_list.csv")
dpt.path <- paste0(data.dir, "dpt3.csv")
# Out
out.dir <- "data/prepped/"
mort.out <- paste0(out.dir, "mort.csv")
stat.out <- paste0(out.dir, "stat.csv")
ebi.out <- paste0(out.dir, "ebi.csv")
plot.dir <- "C:/Users/AustinC/OneDrive - bgC3/Documents/plots/U5M_plots/ebi_summary/"
dir.create(plot.dir, showWarnings = F)
### Code
## Cause-specific mortality
# Read data
dt <- fread(data.path)
birth.dt <- fread(paste0(data.dir, "births.csv"))[sex_id == 3]
setnames(birth.dt, c("year_id", "location_name"), c("year", "location"))
# Calculate other category
all.dt <- copy(dt[cause == "All causes"])
combined.dt <- dt[cause != "All causes", .(sum_val = sum(val)), by = .(age, metric, year, measure, location)]
merge.dt <- merge(all.dt, combined.dt, by = c("age", "metric", "year", "measure", "location"))
merge.dt[, diff := val - sum_val]
merge.dt[, c("val", "upper", "lower", "sum_val") := NULL]
setnames(merge.dt, "diff", "val")
merge.dt[, cause := "Other"]
bound.dt <- rbind(dt, merge.dt, fill = T)
# Combine diphtheria, whooping cough, tetanus into DPT
dpt.causes <- c("Diphtheria", "Whooping cough", "Tetanus")
dpt.hold <- dt[cause %in% dpt.causes]
dpt.dt <- dt[cause %in% dpt.causes, .(val = sum(val)), by = .(age, metric, year, measure, location)]
dpt.dt[, cause := "DPT"]
bound.dt <- rbind(bound.dt[!(cause %in% dpt.causes)], dpt.dt, fill = T)
# Switch rate to have births in denominator
births.merge <- merge(bound.dt[metric == "Number"], birth.dt[, .(location, year, population)], by = c("year", "location"))
births.merge[, val := val / population]
births.merge[, population := NULL]
births.merge[, metric := "Rate"]
bound.dt <- rbind(bound.dt[metric == "Number"], births.merge)
# Calculate 5 year averages
bound.dt[year %%5 != 0, period := paste0((year - year%%5), "-", (year - year%%5 + 5))]
bound.dt[year %%5 == 0, period := paste0((year - year%%5 - 5), "-", (year - year%%5))]
period.dt <- bound.dt[, .(five_avg = mean(val)), by = .(age, metric, period, measure, location, cause)]
mort.dt <- merge(bound.dt, period.dt)
write.csv(mort.dt, mort.out, row.names = F)
## EBI
indicator.table <- data.table(read.csv(ebi.path))
indicator.list <- unique(indicator.table$IndicatorId)
prep.ebi <- function(indicator.list, cause.map = NULL) {
# Import DHS Indicator data for TFR for each survey
json_file <- fromJSON("https://api.dhsprogram.com/rest/dhs/data/FE_FRTR_W_TFR?perpage=500")
pull.indicator <- function(indicator) {
string <- paste0("https://api.dhsprogram.com/rest/dhs/data/", indicator, "?perpage=500")
json_file <- fromJSON(string)
json_data <- lapply(json_file$Data, function(x) { unlist(x) })
APIdata <- as.data.table(do.call("rbind", json_data),stringsAsFactors=FALSE)
return(APIdata)
}
dt <- rbindlist(lapply(indicator.list, pull.indicator))
dt[, Year := as.integer(SurveyYear)]
dt[, Value := as.numeric(Value)]
return(dt[])
}
ebi.raw <- prep.ebi(indicator.list)
ebi.subset <- ebi.raw[, .(IndicatorId, Year, Value, CountryName)]
ebi.dt <- merge(ebi.subset, indicator.table)
setnames(ebi.dt, c("CountryName", "Year", "Value"), c("location", "year", "value"))
ebi.dt[, IndicatorId := NULL]
# DPT3 coverage from WHO
dpt.dt <- fread(dpt.path, header = T)
melt.dpt <- melt(dpt.dt, id.vars = "Cname", variable.name = "year")
setnames(melt.dpt, "Cname", "location")
melt.dpt[, c("Category", "Indicator") := .("DPT", "DPT3 Vaccine")]
ebi.dt <- rbind(ebi.dt, melt.dpt)
write.csv(ebi.dt, ebi.out, row.names = F)
### Stats
# Change between 2000 and 2015
start.val <- mort.dt[metric == "Rate" & age == "Under 5" & year == start.year & measure == "Deaths" & location == cloc, .(cause, val)]
setnames(start.val, "val", "start_val")
end.val <- mort.dt[metric == "Rate" & age == "Under 5" & year == end.year & measure == "Deaths" & location == cloc, .(cause, val)]
setnames(end.val, "val", "end_val")
change.dt <- merge(start.val, end.val)
change.dt[, change := (start_val - end_val) / start_val * 100]
# Rankings
start.val[order(start_val)]
## Table of improvement given uncertainty
bound2.dt <- rbind(mort.dt, dpt.hold, fill = T)
yr1 <- start.year
yr2 <- end.year
subset.mort <- bound2.dt[metric == "Rate" & age == "Under 5" & year %in% c(yr1, yr2) & measure == "Deaths", .(location, cause, year, val, upper, lower)]
# mean.dt <- dcast(subset.mort, location + cause ~ year, value.var = "val")
subset.mort[, cast_val := ifelse(year == start.year, lower, upper)]
cast.dt <- dcast(subset.mort, location + cause ~ year, value.var = "cast_val")
cast.dt[, sig := ifelse(get(as.character(start.year)) > get(as.character(end.year)), 1, 0)]
cast.dt[is.na(sig), sig := 0]
write.csv(cast.dt, stat.out, row.names =  F)
### Data Prep
library(data.table); library(RJSONIO); library(ggplot2); library(plotly)
## Paths
# In
data.dir <- "data/raw/"
data.path <- paste0(data.dir, "GBD16_results_all2.csv")
ebi.path <- paste0("data/indicator_list.csv")
dpt.path <- paste0(data.dir, "dpt3.csv")
# Out
out.dir <- "data/prepped/"
mort.out <- paste0(out.dir, "mort.csv")
stat.out <- paste0(out.dir, "stat.csv")
ebi.out <- paste0(out.dir, "ebi.csv")
plot.dir <- "C:/Users/AustinC/OneDrive - bgC3/Documents/plots/U5M_plots/ebi_summary/"
dir.create(plot.dir, showWarnings = F)
### Code
## Cause-specific mortality
# Read data
dt <- fread(data.path)
# Calculate other category
all.dt <- copy(dt[cause == "All causes"])
combined.dt <- dt[cause != "All causes", .(sum_val = sum(val)), by = .(age, metric, year, measure, location)]
merge.dt <- merge(all.dt, combined.dt, by = c("age", "metric", "year", "measure", "location"))
merge.dt[, diff := val - sum_val]
merge.dt[, c("val", "upper", "lower", "sum_val") := NULL]
setnames(merge.dt, "diff", "val")
merge.dt[, cause := "Other"]
bound.dt <- rbind(dt, merge.dt, fill = T)
# Combine diphtheria, whooping cough, tetanus into DPT
dpt.causes <- c("Diphtheria", "Whooping cough", "Tetanus")
dpt.hold <- dt[cause %in% dpt.causes]
dpt.dt <- dt[cause %in% dpt.causes, .(val = sum(val)), by = .(age, metric, year, measure, location)]
dpt.dt[, cause := "DPT"]
bound.dt <- rbind(bound.dt[!(cause %in% dpt.causes)], dpt.dt, fill = T)
# Calculate 5 year averages
bound.dt[year %%5 != 0, period := paste0((year - year%%5), "-", (year - year%%5 + 5))]
bound.dt[year %%5 == 0, period := paste0((year - year%%5 - 5), "-", (year - year%%5))]
period.dt <- bound.dt[, .(five_avg = mean(val)), by = .(age, metric, period, measure, location, cause)]
mort.dt <- merge(bound.dt, period.dt)
write.csv(mort.dt, mort.out, row.names = F)
## EBI
indicator.table <- data.table(read.csv(ebi.path))
indicator.list <- unique(indicator.table$IndicatorId)
prep.ebi <- function(indicator.list, cause.map = NULL) {
# Import DHS Indicator data for TFR for each survey
json_file <- fromJSON("https://api.dhsprogram.com/rest/dhs/data/FE_FRTR_W_TFR?perpage=500")
pull.indicator <- function(indicator) {
string <- paste0("https://api.dhsprogram.com/rest/dhs/data/", indicator, "?perpage=500")
json_file <- fromJSON(string)
json_data <- lapply(json_file$Data, function(x) { unlist(x) })
APIdata <- as.data.table(do.call("rbind", json_data),stringsAsFactors=FALSE)
return(APIdata)
}
dt <- rbindlist(lapply(indicator.list, pull.indicator))
dt[, Year := as.integer(SurveyYear)]
dt[, Value := as.numeric(Value)]
return(dt[])
}
ebi.raw <- prep.ebi(indicator.list)
ebi.subset <- ebi.raw[, .(IndicatorId, Year, Value, CountryName)]
ebi.dt <- merge(ebi.subset, indicator.table)
setnames(ebi.dt, c("CountryName", "Year", "Value"), c("location", "year", "value"))
ebi.dt[, IndicatorId := NULL]
# DPT3 coverage from WHO
dpt.dt <- fread(dpt.path, header = T)
melt.dpt <- melt(dpt.dt, id.vars = "Cname", variable.name = "year")
setnames(melt.dpt, "Cname", "location")
melt.dpt[, c("Category", "Indicator") := .("DPT", "DPT3 Vaccine")]
ebi.dt <- rbind(ebi.dt, melt.dpt)
write.csv(ebi.dt, ebi.out, row.names = F)
### Data Prep
library(data.table); library(RJSONIO); library(ggplot2); library(plotly)
## Paths
# In
data.dir <- "data/raw/"
data.path <- paste0(data.dir, "GBD16_results_all2.csv")
ebi.path <- paste0("data/indicator_list.csv")
dpt.path <- paste0(data.dir, "dpt3.csv")
# Out
out.dir <- "data/prepped/"
mort.out <- paste0(out.dir, "mort.csv")
stat.out <- paste0(out.dir, "stat.csv")
ebi.out <- paste0(out.dir, "ebi.csv")
plot.dir <- "C:/Users/AustinC/OneDrive - bgC3/Documents/plots/U5M_plots/ebi_summary/"
dir.create(plot.dir, showWarnings = F)
### Code
## Cause-specific mortality
# Read data
dt <- fread(data.path)
# Calculate other category
all.dt <- copy(dt[cause == "All causes"])
combined.dt <- dt[cause != "All causes", .(sum_val = sum(val)), by = .(age, metric, year, measure, location)]
merge.dt <- merge(all.dt, combined.dt, by = c("age", "metric", "year", "measure", "location"))
merge.dt[, diff := val - sum_val]
merge.dt[, c("val", "upper", "lower", "sum_val") := NULL]
setnames(merge.dt, "diff", "val")
merge.dt[, cause := "Other"]
bound.dt <- rbind(dt, merge.dt, fill = T)
# Combine diphtheria, whooping cough, tetanus into DPT
dpt.causes <- c("Diphtheria", "Whooping cough", "Tetanus")
dpt.hold <- dt[cause %in% dpt.causes]
dpt.dt <- dt[cause %in% dpt.causes, .(val = sum(val)), by = .(age, metric, year, measure, location)]
dpt.dt[, cause := "DPT"]
bound.dt <- rbind(bound.dt[!(cause %in% dpt.causes)], dpt.dt, fill = T)
# Calculate 5 year averages
bound.dt[year %%5 != 0, period := paste0((year - year%%5), "-", (year - year%%5 + 5))]
bound.dt[year %%5 == 0, period := paste0((year - year%%5 - 5), "-", (year - year%%5))]
period.dt <- bound.dt[, .(five_avg = mean(val)), by = .(age, metric, period, measure, location, cause)]
mort.dt <- merge(bound.dt, period.dt)
write.csv(mort.dt, mort.out, row.names = F)
## EBI
indicator.table <- data.table(read.csv(ebi.path))
indicator.list <- unique(indicator.table[outlier == 0]$IndicatorId)
prep.ebi <- function(indicator.list, cause.map = NULL) {
# Import DHS Indicator data for TFR for each survey
json_file <- fromJSON("https://api.dhsprogram.com/rest/dhs/data/FE_FRTR_W_TFR?perpage=500")
pull.indicator <- function(indicator) {
string <- paste0("https://api.dhsprogram.com/rest/dhs/data/", indicator, "?perpage=500")
json_file <- fromJSON(string)
json_data <- lapply(json_file$Data, function(x) { unlist(x) })
APIdata <- as.data.table(do.call("rbind", json_data),stringsAsFactors=FALSE)
return(APIdata)
}
dt <- rbindlist(lapply(indicator.list, pull.indicator))
dt[, Year := as.integer(SurveyYear)]
dt[, Value := as.numeric(Value)]
return(dt[])
}
ebi.raw <- prep.ebi(indicator.list)
ebi.subset <- ebi.raw[!grepl('Five', ByVariableLabel), .(IndicatorId, Year, Value, CountryName)]
ebi.dt <- merge(ebi.subset, indicator.table)
setnames(ebi.dt, c("CountryName", "Year", "Value"), c("location", "year", "value"))
ebi.dt[, c("IndicatorId", "outlier") := NULL]
# DPT3 coverage from WHO
dpt.dt <- fread(dpt.path, header = T)
melt.dpt <- melt(dpt.dt, id.vars = "Cname", variable.name = "year")
setnames(melt.dpt, "Cname", "location")
melt.dpt[, c("Category", "Indicator") := .("DPT", "DPT3 Vaccine")]
ebi.dt <- rbind(ebi.dt, melt.dpt)
write.csv(ebi.dt, ebi.out, row.names = F)
### Stats
# Change between 2000 and 2015
start.val <- mort.dt[metric == "Rate" & age == "Under 5" & year == start.year & measure == "Deaths" & location == cloc, .(cause, val)]
setnames(start.val, "val", "start_val")
end.val <- mort.dt[metric == "Rate" & age == "Under 5" & year == end.year & measure == "Deaths" & location == cloc, .(cause, val)]
setnames(end.val, "val", "end_val")
change.dt <- merge(start.val, end.val)
change.dt[, change := (start_val - end_val) / start_val * 100]
# Rankings
start.val[order(start_val)]
## Table of improvement given uncertainty
bound2.dt <- rbind(mort.dt, dpt.hold, fill = T)
yr1 <- start.year
yr2 <- end.year
subset.mort <- bound2.dt[metric == "Rate" & age == "Under 5" & year %in% c(yr1, yr2) & measure == "Deaths", .(location, cause, year, val, upper, lower)]
# mean.dt <- dcast(subset.mort, location + cause ~ year, value.var = "val")
subset.mort[, cast_val := ifelse(year == start.year, lower, upper)]
cast.dt <- dcast(subset.mort, location + cause ~ year, value.var = "cast_val")
start.val <- mort.dt[metric == "Rate" & age == "Under 5" & year == start.year & measure == "Deaths", .(location, cause, val)]
setnames(start.val, "val", "start_val")
end.val <- mort.dt[metric == "Rate" & age == "Under 5" & year == end.year & measure == "Deaths", .(location, cause, val)]
setnames(end.val, "val", "end_val")
change.dt <- merge(start.val, end.val)
change.dt[, change := (start_val - end_val) / start_val * 100]
### Stats
# Change between 2000 and 2015
start.val <- mort.dt[metric == "Rate" & age == "Under 5" & year == start.year & measure == "Deaths", .(location, cause, val)]
start.year <- 2000
end.year <- 2015
start.val <- mort.dt[metric == "Rate" & age == "Under 5" & year == start.year & measure == "Deaths", .(location, cause, val)]
setnames(start.val, "val", "start_val")
end.val <- mort.dt[metric == "Rate" & age == "Under 5" & year == end.year & measure == "Deaths", .(location, cause, val)]
setnames(end.val, "val", "end_val")
change.dt <- merge(start.val, end.val)
change.dt[, change := (start_val - end_val) / start_val * 100]
# Rankings
start.val[order(start_val)]
## Table of improvement given uncertainty
bound2.dt <- rbind(mort.dt, dpt.hold, fill = T)
yr1 <- start.year
yr2 <- end.year
subset.mort <- bound2.dt[metric == "Rate" & age == "Under 5" & year %in% c(yr1, yr2) & measure == "Deaths", .(location, cause, year, val, upper, lower)]
# mean.dt <- dcast(subset.mort, location + cause ~ year, value.var = "val")
subset.mort[, cast_val := ifelse(year == start.year, lower, upper)]
subset.mort
cast.dt <- dcast(subset.mort, location + cause ~ year, value.var = "cast_val")
cast.dt[, sig := ifelse(get(as.character(start.year)) > get(as.character(end.year)), 1, 0)]
cast.dt[is.na(sig), sig := 0]
cast.dt[location == "Rwanda"]
write.csv(cast.dt, stat.out, row.names =  F)
# Pull Rotavirus
fromJSON("http://apps.who.int/gho/athena/api/GHO/ROTAC?filter=COUNTRY:RWA&format=json")
# Pull Rotavirus
fread("http://apps.who.int/gho/athena/api/GHO/ROTAC?filter=COUNTRY:RWA&format=csv")
# Pull Rotavirus
fread("http://apps.who.int/gho/athena/api/GHO/ROTAC?filter=COUNTRY:GHA&format=csv")
# Pull Rotavirus
fread("http://apps.who.int/gho/athena/api/GHO/ROTAC?filter=format=csv")
# Pull Rotavirus
rota.dtfread("http://apps.who.int/gho/athena/api/GHO/ROTAC?filter=COUNTRY:RWA,SEN&format=csv")
# Pull Rotavirus
rota.dt <- fread("http://apps.who.int/gho/athena/api/GHO/ROTAC?filter=COUNTRY:RWA,SEN&format=csv")
# Pull Rotavirus
rota.dt <- fread("http://apps.who.int/gho/athena/api/GHO/ROTAC?filter=COUNTRY:*&format=csv")
rota.dt
# DPT3 coverage from WHO
dpt.dt <- fread(dpt.path, header = T)
dtp3.dt <- fread("http://apps.who.int/gho/athena/api/GHO/EQ_DTP3?filter=COUNTRY:*&format=csv")
dtp3.dt
dtp3.dt[COUNTRY == "RWA"]
dtp3.dt[COUNTRY == "RWA", YEAR == 2000]
dtp3.dt[COUNTRY == "RWA" & YEAR == 2000]
dpt.dt
dpt.dt[Cname == "Rwanda"]
dtp3.dt <- fread("http://apps.who.int/gho/athena/api/GHO/dtpv?filter=COUNTRY:*&format=csv")
dtp3.dt <- fread("http://apps.who.int/gho/athena/api/GHO/dptv?filter=COUNTRY:*&format=csv")
dtp3.dt[COUNTRY == "RWA"]
dtp3.dt <- fread("http://apps.who.int/gho/athena/api/GHO/dptv?filter=COUNTRY:*&format=csv&YEAR=*")
dtp3.dt[COUNTRY == "RWA"]
dtp3.dt <- fread("http://apps.who.int/gho/athena/api/GHO/dptv?filter=COUNTRY:*&format=csv&YEAR=*")
unique(dtp3.dt$YEAR)
unique(dtp3.dt[COUNTRY == "RWA"]$YEAR)
# Pull Rotavirus
rota.dt <- fread("http://apps.who.int/gho/athena/api/GHO/ROTAC?filter=COUNTRY:*&format=csv,dptv?filter=COUNTRY:*&format=csv")
bcg.dt <- fread("http://apps.who.int/gho/athena/api/GHO/bcgv?filter=COUNTRY:*&format=csv&YEAR=*")
bcg.dt[COUNTRY == "RWA"]
